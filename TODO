* views should return a Response (possibly take one as an arg).

* Make request/response objects thread-local to prepare for a realistic server environment.

* Clean up/improve debugmiddleware, add option to switch it out with another.
